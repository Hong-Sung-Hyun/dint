---
title: "Dint: Special Purpose Integer Dates "
author: "Stefan Fleck"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(dint)
```

dint is for converting, formatting, and calculating with year-quarter 
and year-month dates. It is implemented in base R and comes with zero 
external dependencies. It also integrates well with lubridate, in case you 
are already using this neat package. Even if you don't need to work with such 
special dates directly, dint can still help you format (for example) plot axis. 


# The date_yq and date_ym classes

```{r}

# date_* Objects can be created using explicit constructors...
date_yq(2015, 1)
date_ym(c(2015, 2016), c(1, 2))


# ...or through coercion of dates or integers
as_date_ym(Sys.Date())
as_date_yq(20141)


# You can also convert date_* Objects to proper Dates. In this case you get the 
# first day of the period
as.Date(date_yq(2015, 1))
as.Date(date_ym(2015, 3))

```




# Arithmetic with integer dates

```{r}

# Months
m <- as_date_ym(201412)
m
m + 1

# Quarters
q <- as_date_yq(20144)
q
q + 1

```


# Accessing elements

```{r}

get_year(m)
get_quarter(m)
get_month(m)

get_quarter(q)
get_month(q) # defaults to first month of quarter


```


If you use lubridate, you can just use the slighly less verbose lubridate 
accessors

```{r}
stopifnot(requireNamespace("lubridate"))

lubridate::year(m)
lubridate::quarter(m)
lubridate::month(m)

# There are also some extra functions in dint that only work if you have 
# lubridate installed:

first_day_of_quarter(q)
last_day_of_quarter(q)

```



# Formatting


Formating `date_yq` Objects is easy. Currently, three different formatting 
presets are defined for dint dates.

```{r}
format(q, "iso")  # default
format(q, "short")
format(q, "shorter")

format(m, "iso")  # default
format(m, "short")
format(m, "shorter")
```


For convenience, dint provides direct formatting functions for dates that are 
useful for labelling ggplot axis.

```{r}
library(ggplot2)

x <- data.frame(
  time  = seq(as.Date("2016-01-01"), as.Date("2016-08-08"), by = "day")
)

x$value <- rnorm(nrow(x))

p <- ggplot(
  x,
  aes(
    x = time, 
    y = value)
  ) + geom_point()


print(p)
print(p + scale_x_date(labels = format_date_yq_iso))
print(p + scale_x_date(labels = format_date_ym_short))

```

